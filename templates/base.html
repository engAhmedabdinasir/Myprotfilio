{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}My Portfolio{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        slate: {
                            850: '#1e293b', // Custom dark slate
                        }
                    }
                }
            }
        }
    </script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="{% static 'css/custom.css' %}" rel="stylesheet">
    {% block extra_head %}{% endblock %}
    <script>
        // On page load or when changing themes, best to add inline in `head` to avoid FOUC
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark')
        } else {
            document.documentElement.classList.remove('dark')
        }
    </script>
</head>

<body
    class="flex flex-col min-h-screen bg-slate-50 dark:bg-slate-900 text-gray-900 dark:text-gray-100 transition-colors duration-300">

    <!-- Navigation -->
    <nav class="navbar fixed w-full z-50 transition-all duration-300 border-b border-transparent dark:border-slate-800"
        id="navbar">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex-shrink-0 flex items-center">
                    <a href="{% url 'home' %}" class="text-2xl font-bold text-gray-800 dark:text-gray-100">Portfolio</a>
                </div>
                <div class="hidden md:flex items-center space-x-6">
                    <a href="{% url 'home' %}"
                        class="nav-link text-gray-600 hover:text-indigo-600 dark:text-gray-300 dark:hover:text-purple-400 font-medium transition {% if request.resolver_match.url_name == 'home' %}text-indigo-600 dark:text-purple-400{% endif %}">Home</a>
                    <a href="{% url 'project_list' %}"
                        class="nav-link text-gray-600 hover:text-indigo-600 dark:text-gray-300 dark:hover:text-purple-400 font-medium transition {% if 'projects' in request.path %}text-indigo-600 dark:text-purple-400{% endif %}">Projects</a>
                    <a href="{% url 'blog_list' %}"
                        class="nav-link text-gray-600 hover:text-indigo-600 dark:text-gray-300 dark:hover:text-purple-400 font-medium transition {% if 'blog' in request.path %}text-indigo-600 dark:text-purple-400{% endif %}">Blog</a>
                    <a href="{% url 'contact' %}"
                        class="nav-link text-gray-600 hover:text-indigo-600 dark:text-gray-300 dark:hover:text-purple-400 font-medium transition {% if 'contact' in request.path %}text-indigo-600 dark:text-purple-400{% endif %}">Contact</a>

                    <!-- Theme Toggle Button -->
                    <button id="theme-toggle"
                        class="p-2 rounded-lg text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:focus:ring-slate-700 transition">
                        <i id="theme-toggle-dark-icon" class="fas fa-moon hidden"></i>
                        <i id="theme-toggle-light-icon" class="fas fa-sun hidden"></i>
                    </button>

                    {% if user.is_authenticated %}
                    <span class="text-sm text-gray-500 dark:text-gray-400">Welcome, {{ user.username }}</span>
                    {% else %}
                    <a href="{% url 'login' %}"
                        class="px-4 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-700 text-white font-medium transition shadow-md dark:bg-purple-600 dark:hover:bg-purple-700">Login</a>
                    {% endif %}
                </div>
                <!-- Mobile menu button -->
                <div class="md:hidden flex items-center space-x-3">
                    <!-- Mobile Theme Toggle -->
                    <button id="theme-toggle-mobile"
                        class="p-2 rounded-lg text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-slate-800 focus:outline-none">
                        <i class="fas fa-moon dark:hidden"></i>
                        <i class="fas fa-sun hidden dark:block"></i>
                    </button>
                    <button
                        class="text-gray-500 dark:text-gray-300 hover:text-gray-700 dark:hover:text-white focus:outline-none"
                        onclick="document.getElementById('mobile-menu').classList.toggle('hidden')">
                        <i class="fas fa-bars text-2xl"></i>
                    </button>
                </div>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div class="hidden md:hidden bg-white/95 dark:bg-slate-900/95 backdrop-blur-md border-t border-gray-100 dark:border-slate-800"
            id="mobile-menu">
            <a href="{% url 'home' %}"
                class="block px-4 py-3 text-base font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-slate-800">Home</a>
            <a href="{% url 'project_list' %}"
                class="block px-4 py-3 text-base font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-slate-800">Projects</a>
            <a href="{% url 'blog_list' %}"
                class="block px-4 py-3 text-base font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-slate-800">Blog</a>
            <a href="{% url 'contact' %}"
                class="block px-4 py-3 text-base font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-slate-800">Contact</a>
            {% if not user.is_authenticated %}
            <a href="{% url 'login' %}"
                class="block px-4 py-3 text-base font-medium text-indigo-600 dark:text-purple-400 font-semibold hover:bg-gray-50 dark:hover:bg-slate-800">Login</a>
            {% endif %}
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow pt-16">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer
        class="bg-white/80 dark:bg-slate-900/80 backdrop-blur-sm mt-auto py-8 border-t border-gray-200 dark:border-slate-800 transition-colors duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-gray-600 dark:text-gray-400">
            <p>&copy; {% now "Y" %} My Portfolio. All rights reserved.</p>
            <div class="flex justify-center space-x-6 mt-4">
                {% if profile.github_url %}
                <a href="{{ profile.github_url }}" target="_blank"
                    class="text-gray-400 hover:text-indigo-600 dark:hover:text-purple-400 transition duration-300"><i
                        class="fab fa-github text-xl"></i></a>
                {% endif %}
                {% if profile.linkedin_url %}
                <a href="{{ profile.linkedin_url }}" target="_blank"
                    class="text-gray-400 hover:text-blue-500 dark:hover:text-cyan-400 transition duration-300"><i
                        class="fab fa-linkedin text-xl"></i></a>
                {% endif %}
                {% if profile.twitter_url %}
                <a href="{{ profile.twitter_url }}" target="_blank"
                    class="text-gray-400 hover:text-blue-400 dark:hover:text-blue-300 transition duration-300"><i
                        class="fab fa-twitter text-xl"></i></a>
                {% endif %}
            </div>
        </div>
    </footer>

    <script>
        // Navbar scroll effect
        window.addEventListener('scroll', function () {
            const navbar = document.getElementById('navbar');
            if (window.scrollY > 10) {
                navbar.classList.add('shadow-md', 'bg-white/90', 'dark:bg-slate-900/90');
                navbar.classList.remove('bg-transparent');
            } else {
                navbar.classList.remove('shadow-md', 'bg-white/90', 'dark:bg-slate-900/90');
                navbar.classList.add('bg-transparent');
            }
        });

        // Theme Toggle Logic
        var themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
        var themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');
        var themeToggleBtn = document.getElementById('theme-toggle');
        var themeToggleMobileBtn = document.getElementById('theme-toggle-mobile');

        // Change the icons inside the button based on previous settings
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            themeToggleLightIcon.classList.remove('hidden');
        } else {
            themeToggleDarkIcon.classList.remove('hidden');
        }

        function toggleTheme() {
            // toggle icons inside button
            themeToggleDarkIcon.classList.toggle('hidden');
            themeToggleLightIcon.classList.toggle('hidden');

            // if set via local storage previously
            if (localStorage.theme === 'dark') {
                document.documentElement.classList.remove('dark');
                localStorage.theme = 'light';
            } else {
                document.documentElement.classList.add('dark');
                localStorage.theme = 'dark';
            }
        }

        themeToggleBtn.addEventListener('click', toggleTheme);
        if (themeToggleMobileBtn) {
            themeToggleMobileBtn.addEventListener('click', function () {
                document.documentElement.classList.toggle('dark');
                if (document.documentElement.classList.contains('dark')) {
                    localStorage.theme = 'dark';
                } else {
                    localStorage.theme = 'light';
                }
                // Update desktop icons if needed, though usually one is visible
                if (localStorage.theme === 'dark') {
                    themeToggleDarkIcon.classList.add('hidden');
                    themeToggleLightIcon.classList.remove('hidden');
                } else {
                    themeToggleLightIcon.classList.add('hidden');
                    themeToggleDarkIcon.classList.remove('hidden');
                }
            });
        }
    </script>
</body>

</html>